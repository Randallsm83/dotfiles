# SSH Configuration for 1Password Agent
# Works across Windows, WSL, macOS, and Linux
# Uses 1Password agent for key management with per-host restrictions

# Platform-specific configuration (WSL, macOS, etc.)
# Create ~/.ssh/config.d/<platform> files as needed
Include config.d/*

# Global defaults - security hardening and reliability
Host *
  # 1Password SSH agent (platform-specific path)
{{- if eq .chezmoi.os "windows" }}
  IdentityAgent "//./pipe/openssh-ssh-agent"
{{- else }}
  IdentityAgent ~/.1password/agent.sock
{{- end }}

  # Security settings
  IdentitiesOnly no
  AddKeysToAgent no
  ForwardAgent no
  HashKnownHosts yes
  PreferredAuthentications publickey
  GSSAPIAuthentication no

  # Connection reliability
  ServerAliveInterval 60
  ServerAliveCountMax 3

  # Note: IdentityFile is NOT set here
  # 1Password agent automatically selects the correct key based on "Allowed hosts"
  # configured in each SSH Key item in 1Password

# GitHub
Host github.com
  HostName github.com
  User git
  PubkeyAuthentication yes
  IdentitiesOnly no

# DreamHost Git
Host git.dreamhost.com
  HostName git.dreamhost.com
  User rmiller
  PubkeyAuthentication yes

# DreamHost yakko shell server
Host yakko
  HostName yakko.sd.dreamhost.com
  User rmiller
  ForwardAgent yes
  PubkeyAuthentication yes
  IdentitiesOnly no

# DreamHost porky shell server
Host porky
  HostName porky.sd.dreamhost.com
  User rmiller
  ForwardAgent yes
  PubkeyAuthentication yes

# DreamHost easterseals shell server
Host easterseals
  HostName vps54643.dreamhostps.com
  User easterseals
  ForwardAgent yes
  PubkeyAuthentication yes
  IdentitiesOnly no

# DreamHost dreampress server
Host fp3
  HostName fp3.randall.codes
  User wp_zgm8xm
  ForwardAgent yes
  PubkeyAuthentication yes
  IdentitiesOnly no
