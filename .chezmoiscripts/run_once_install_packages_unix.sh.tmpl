{{- if ne .chezmoi.os "windows" -}}
#!/usr/bin/env bash
#
# Install packages on Unix (Linux/WSL/macOS)
# This script runs once after chezmoi initialization

set -eo pipefail

# Colors for output
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() {
    echo -e "${CYAN}ℹ${NC} $1"
}

log_success() {
    echo -e "${GREEN}✓${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}⚠${NC} $1"
}

command_exists() {
    command -v "$1" >/dev/null 2>&1
}

echo "╔══════════════════════════════════════════╗"
echo "║        Installing Unix Packages         ║"
echo "╚══════════════════════════════════════════╝"
echo ""

# Install mise if not present
if ! command_exists mise; then
    log_info "Installing mise..."
    curl https://mise.run | sh
    export PATH="$HOME/.local/bin:$PATH"
    eval "$(~/.local/bin/mise activate bash)"
fi

if command_exists mise; then
    log_success "mise is available"
    log_info "Installing tools and runtimes via mise config..."
    log_info "Config: ~/.config/mise/config.toml + config.linux.toml"
    
    # Mise will read config.toml and config.linux.toml automatically
    mise install || log_warning "Some mise installations may have failed"
    
    log_success "Mise tools installed"
else
    log_warning "mise not available, skipping package installation"
fi

echo ""
log_success "Package installation completed!"
echo ""
{{- end -}}
