{{- if eq .chezmoi.os "windows" -}}
#!/usr/bin/env pwsh
#
# Install VSCode extensions after VSCode is installed
# Runs after package installation

$ErrorActionPreference = 'Continue'

function Write-Status {
    param([string]$Message, [string]$Type = 'Info')
    $colors = @{ Info = 'Cyan'; Success = 'Green'; Warning = 'Yellow'; Error = 'Red' }
    $symbols = @{ Info = 'ℹ'; Success = '✓'; Warning = '⚠'; Error = '✗' }
    Write-Host "$($symbols[$Type]) " -ForegroundColor $colors[$Type] -NoNewline
    Write-Host $Message
}

# Check if VSCode is installed
if (-not (Get-Command code -ErrorAction SilentlyContinue)) {
    Write-Status "VSCode not found in PATH, skipping extension installation" -Type Warning
    exit 0
}

Write-Status "Installing VSCode extensions..." -Type Info

$extensionsFile = "{{ .chezmoi.sourceDir }}/dot_config/windows/scripts/vscode-extensions.txt"
if (Test-Path $extensionsFile) {
    Get-Content $extensionsFile | Where-Object { $_ -and $_.Trim() -and !$_.StartsWith('#') } | ForEach-Object {
        $extension = $_.Trim()
        Write-Status "Installing extension: $extension" -Type Info
        try {
            code --install-extension $extension --force
        } catch {
            Write-Status "Failed to install $extension`: $_" -Type Warning
        }
    }
    Write-Status "VSCode extensions installation completed!" -Type Success
} else {
    Write-Status "Extensions file not found: $extensionsFile" -Type Warning
}
{{- end }}
