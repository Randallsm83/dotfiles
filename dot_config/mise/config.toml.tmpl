# =============================================================================
# MISE CONFIGURATION
# =============================================================================
# Platform-specific tool management strategy:
#
#   Windows:
#     - mise: Language runtimes (node, python, ruby, go, rust, bun, deno, etc.)
#     - scoop: CLI tools (bat, eza, fd, ripgrep, starship, neovim, etc.)
#     - winget: GUI applications
#
#   Linux/WSL/macOS:
#     - mise: Everything (CLI tools + language runtimes)
#     - homebrew: macOS GUI apps only (warp, wezterm)
# =============================================================================

[tools]
# === Language Runtimes (based on feature flags) ===
{{- if .package_features.node }}
node = "lts"
{{- end }}
{{- if .package_features.python }}
python = "latest"
{{- end }}
{{- if .package_features.ruby }}
ruby = "latest"
{{- end }}
{{- if .package_features.golang }}
go = "latest"
{{- end }}
{{- if .package_features.rust }}
rust = "stable"
{{- end }}
{{- if and .package_features.lua (ne .chezmoi.os "windows") }}
lua = "latest"
{{- end }}
zig = "latest"
{{- if .package_features.perl }}
perl = "latest"
{{- end }}
{{- if .package_features.php }}
php = "latest"
{{- end }}

# === Always-installed runtimes ===
bun = "latest"
deno = "latest"

# === Universal Tools ===
{{- if .package_features.direnv }}
direnv = "latest"
{{- end }}
{{- range .always_install.mise }}
{{ . }} = "latest"
{{- end }}
{{- if .package_features.node }}
yarn = "latest"
{{- end }}
{{- if .package_features.python }}
uv = "latest"
pipx = "latest"
{{- end }}

{{- if ne .chezmoi.os "windows" }}
# === CLI Tools (Linux/WSL/macOS only - based on feature flags) ===
{{- if .package_features.git }}
github-cli = "latest"  # gh
{{- end }}
{{- if index .package_features "1password" }}
op = "latest"  # 1Password CLI
{{- end }}
{{- if .package_features.nvim }}
neovim = "latest"
{{- end }}
{{- if .package_features.starship }}
starship = "latest"
{{- end }}
{{- if .package_features.bat }}
"cargo:bat" = "latest"
{{- end }}
{{- if .package_features.eza }}
"cargo:eza" = "latest"
{{- end }}
{{- if .package_features.ripgrep }}
"cargo:ripgrep" = "latest"
{{- end }}
{{- if .package_features.fd }}
"cargo:fd-find" = "latest"
{{- end }}
{{- if .package_features.fzf }}
fzf = "latest"
{{- end }}
{{- if .package_features.zoxide }}
"cargo:zoxide" = "latest"
{{- end }}
{{- if .package_features.delta }}
"cargo:git-delta" = "latest"
{{- end }}
{{- if .package_features.vivid }}
"cargo:vivid" = "latest"
{{- end }}
{{- if .package_features.glow }}
glow = "latest"
{{- end }}
{{- if .package_features.bat }}
bat-extras = "latest"
{{- end }}
{{- if .package_features.btop }}
btop = "latest"
{{- end }}
{{- if .package_features.sqlite3 }}
sqlite = "latest"
{{- end }}

# Build tools
cargo-binstall = "latest"
{{- if .package_features.thefuck }}
# thefuck requires git install due to setuptools issues in Python 3.12+
"pipx:git+https://github.com/nvbn/thefuck.git" = "master"
{{- end }}
{{- end }}

[settings]
idiomatic_version_file = true
idiomatic_version_file_disable_tools = []
always_keep_download = false
always_keep_install = false
plugin_autoupdate_last_check_duration = '1 week'
trusted_config_paths = ['']
verbose = false
http_timeout = "30s"
jobs = 4
raw = false
yes = false
not_found_auto_install = true
task_output = "prefix"
paranoid = false
shorthands_file = '~/.config/mise/shorthands.toml'
disable_default_shorthands = false
experimental = true
status = { missing_tools = "if_other_versions_installed", show_env = false, show_tools = false }

{{- if eq .chezmoi.os "windows" }}
# Disable tools that don't work well via mise on Windows
disable_tools = ["lua", "luajit"]
{{- else }}
disable_tools = []
{{- end }}

# cargo
cargo = { binstall = true }

# node
node = {}

# npm - use bun instead
npm = { bun = true }

# pipx - use uv instead
pipx = { uvx = true }

# python
python = {}

# ruby
ruby = {}

[_]
# Comments and metadata

[env]
