# =============================================================================
# MISE CONFIGURATION
# =============================================================================
# Platform-specific tool management strategy:
#
#   Windows:
#     - mise: Language runtimes (node, python, ruby, go, rust, bun, deno, etc.)
#     - scoop: CLI tools (bat, eza, fd, ripgrep, starship, neovim, etc.)
#     - winget: GUI applications
#
#   Linux/WSL/macOS:
#     - mise: Everything (CLI tools + language runtimes)
#     - homebrew: macOS GUI apps only (warp, wezterm)
# =============================================================================

[tools]
# === Language Runtimes ===
# Versions extracted from package_mapping.{lang}.{os}.mise arrays
{{- if .package_features.node }}
{{- $mapping := index .package_mapping "node" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
node = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- if .package_features.python }}
{{- $mapping := index .package_mapping "python" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
python = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- if .package_features.ruby }}
{{- $mapping := index .package_mapping "ruby" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
ruby = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- if .package_features.golang }}
{{- $mapping := index .package_mapping "golang" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
go = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- if .package_features.rust }}
{{- $mapping := index .package_mapping "rust" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
rust = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- if and .package_features.lua (ne .chezmoi.os "windows") }}
{{- $mapping := index .package_mapping "lua" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- if $miseList }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
lua = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
luajit = "latest"
{{- end }}
zig = "latest"
{{- if .package_features.php }}
{{- $mapping := index .package_mapping "php" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- if $miseList }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
php = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- end }}
{{- if .package_features.perl }}
{{- $mapping := index .package_mapping "perl" }}
{{- $miseList := index $mapping .chezmoi.os "mise" }}
{{- if $miseList }}
{{- $first := index $miseList 0 }}
{{- $parts := splitList "@" $first }}
perl = "{{ if gt (len $parts) 1 }}{{ index $parts 1 }}{{ else }}latest{{ end }}"
{{- end }}
{{- end }}

# === Universal Tools ===
{{- if .package_features.direnv }}
direnv = "latest"
{{- end }}
{{- range .always_install.mise }}
{{ . }} = "latest"
{{- end }}
{{- if .package_features.node }}
bun = "latest"
deno = "latest"
yarn = "latest"
{{- end }}
{{- if .package_features.python }}
uv = "latest"
{{- if ne .chezmoi.os "windows" }}
pipx = "latest"
{{- end }}
{{- end }}

{{- if ne .chezmoi.os "windows" }}
# === CLI Tools (Linux/WSL/macOS) ===
{{- if .package_features.git }}
github-cli = "latest"  # gh
{{- end }}
{{- if .package_features.nvim }}
neovim = "latest"
{{- end }}
{{- if .package_features.vim }}
vim = "latest"
{{- end }}
{{- if .package_features.starship }}
starship = "latest"
{{- end }}
{{- if .package_features.bat }}
"cargo:bat" = "latest"
{{- end }}
{{- if .package_features.eza }}
"cargo:eza" = "latest"
{{- end }}
{{- if .package_features.ripgrep }}
"cargo:ripgrep" = "latest"
{{- end }}
{{- if .package_features.fd }}
"cargo:fd-find" = "latest"
{{- end }}
{{- if .package_features.fzf }}
fzf = "latest"
{{- end }}
{{- if .package_features.zoxide }}
"cargo:zoxide" = "latest"
{{- end }}
{{- if .package_features.delta }}
"cargo:git-delta" = "latest"
{{- end }}
{{- if .package_features.vivid }}
"cargo:vivid" = "latest"
{{- end }}
{{- if .package_features.glow }}
glow = "latest"
{{- end }}
{{- if .package_features.bat }}
bat-extras = "latest"
{{- end }}
{{- if .package_features.btop }}
btop = "latest"
{{- end }}
{{- if .package_features.sqlite3 }}
sqlite = "latest"
{{- end }}

# Build tools
cargo-binstall = "latest"
chezmoi = "latest"
{{- if .package_features.thefuck }}
# thefuck requires git install due to setuptools issues in Python 3.12+
"pipx:git+https://github.com/nvbn/thefuck.git" = "master"
{{- end }}
{{- end }}

[settings]
idiomatic_version_file = true
idiomatic_version_file_disable_tools = []
always_keep_download = false
always_keep_install = false
plugin_autoupdate_last_check_duration = '1 week'
trusted_config_paths = ['']
verbose = false
http_timeout = "30s"
jobs = 4
raw = false
yes = false
not_found_auto_install = true
task_output = "prefix"
paranoid = false
shorthands_file = '~/.config/mise/shorthands.toml'
disable_default_shorthands = false
experimental = true
status = { missing_tools = "if_other_versions_installed", show_env = false, show_tools = false }

{{- if eq .chezmoi.os "windows" }}
# Disable tools that don't work well via mise on Windows
disable_tools = ["lua", "luajit"]
{{- else }}
disable_tools = []
{{- end }}

# cargo
cargo = { binstall = true }

# node
node = {}

# npm - use bun instead
npm = { bun = true }

{{- if ne .chezmoi.os "windows" }}
# pipx - use uv instead
pipx = { uvx = true }
{{- end }}

# python
python = {}

# ruby
ruby = {}

[_]
# Comments and metadata

[env]
