{{- if ne .chezmoi.os "windows" -}}
# Zsh environment - Managed by chezmoi
# Last updated: {{ now | date "2006-01-02" }}
# Loaded for all zsh invocations (login, interactive, scripts)

# XDG Base Directory specification
export XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
export XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
export XDG_STATE_HOME="${XDG_STATE_HOME:-$HOME/.local/state}"
export XDG_CACHE_HOME="${XDG_CACHE_HOME:-$HOME/.cache}"

# Ensure directories exist
mkdir -p "$XDG_CONFIG_HOME" "$XDG_DATA_HOME" "$XDG_STATE_HOME" "$XDG_CACHE_HOME"

# PATH configuration
export PATH="$HOME/.local/bin:$PATH"

{{- if eq .chezmoi.os "darwin" }}
# macOS: Add Homebrew to PATH if it exists
if [ -d "/opt/homebrew/bin" ]; then
    export PATH="/opt/homebrew/bin:$PATH"
fi
{{- end }}

# Language-specific environment variables (XDG compliance)

# Go
export GOPATH="$XDG_DATA_HOME/go"
export GOBIN="$GOPATH/bin"
export PATH="$GOBIN:$PATH"

# Rust
export CARGO_HOME="$XDG_DATA_HOME/cargo"
export RUSTUP_HOME="$XDG_DATA_HOME/rustup"
export PATH="$CARGO_HOME/bin:$PATH"

# Ruby
export BUNDLE_USER_CONFIG="$XDG_CONFIG_HOME/bundle"
export BUNDLE_USER_CACHE="$XDG_CACHE_HOME/bundle"
export BUNDLE_USER_PLUGIN="$XDG_DATA_HOME/bundle"
export GEM_HOME="$XDG_DATA_HOME/gem"
export GEM_SPEC_CACHE="$XDG_CACHE_HOME/gem"
export PATH="$GEM_HOME/bin:$PATH"

# Node.js / npm
export NPM_CONFIG_USERCONFIG="$XDG_CONFIG_HOME/npm/npmrc"
export NPM_CONFIG_CACHE="$XDG_CACHE_HOME/npm"
export NODE_REPL_HISTORY="$XDG_STATE_HOME/node_repl_history"

# Python
export PYTHONPYCACHEPREFIX="$XDG_CACHE_HOME/python"
export PYTHONUSERBASE="$XDG_DATA_HOME/python"
export PYTHON_HISTORY="$XDG_STATE_HOME/python_history"
export IPYTHONDIR="$XDG_CONFIG_HOME/ipython"
export JUPYTER_CONFIG_DIR="$XDG_CONFIG_HOME/jupyter"

# Perl
export PERL5LIB="$XDG_DATA_HOME/perl5/lib/perl5"
export PERL_LOCAL_LIB_ROOT="$XDG_DATA_HOME/perl5"
export PERL_MB_OPT="--install_base $XDG_DATA_HOME/perl5"
export PERL_MM_OPT="INSTALL_BASE=$XDG_DATA_HOME/perl5"

# Less (pager)
export LESSHISTFILE="$XDG_STATE_HOME/less/history"
export LESSKEY="$XDG_CONFIG_HOME/less/lesskey"

# wget
export WGETRC="$XDG_CONFIG_HOME/wget/wgetrc"

# GnuPG
export GNUPGHOME="$XDG_DATA_HOME/gnupg"

# Docker
export DOCKER_CONFIG="$XDG_CONFIG_HOME/docker"

# Kubernetes
export KUBECONFIG="$XDG_CONFIG_HOME/kube/config"

# Editor preferences
export EDITOR="nvim"
export VISUAL="nvim"
export PAGER="less"

# Shell options
export SHELL_SESSIONS_DISABLE=1  # Disable macOS Terminal.app session restore

# Mise configuration directory
export MISE_CONFIG_DIR="$XDG_CONFIG_HOME/mise"
export MISE_DATA_DIR="$XDG_DATA_HOME/mise"
export MISE_CACHE_DIR="$XDG_CACHE_HOME/mise"

# Ensure language-specific directories exist
mkdir -p "$GOPATH" "$CARGO_HOME" "$GEM_HOME" "$PYTHONUSERBASE"
mkdir -p "$XDG_CONFIG_HOME/npm" "$XDG_CACHE_HOME/npm"
mkdir -p "$XDG_STATE_HOME/less" "$XDG_CONFIG_HOME/less"
{{- end -}}
